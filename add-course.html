<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Add Course</title>
    <style>
      /* Basic Reset and Box Sizing */
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        background-color: #f0f2f5;
        color: #333;
        line-height: 1.6;
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
      }
      
      .form-container {
        background-color: #fff;
        padding: 2rem;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        width: 90%;
        max-width: 500px;
        text-align: center;
      }
      
      .form-container h1 {
        color: #007bff;
        margin-bottom: 1.5rem;
      }
      
      #add-course-form {
        display: flex;
        flex-direction: column;
        gap: 1rem;
        text-align: left;
      }
      
      #add-course-form label {
        font-weight: bold;
        color: #555;
      }
      
      #add-course-form input,
      #add-course-form select {
        padding: 0.75rem;
        border: 1px solid #ccc;
        border-radius: 5px;
        width: 100%;
        font-size: 1rem;
      }
      
      #add-course-form button {
        background-color: #28a745;
        color: white;
        border: none;
        padding: 1rem;
        border-radius: 5px;
        cursor: pointer;
        font-size: 1.1rem;
        margin-top: 1rem;
        transition: background-color 0.3s ease;
      }
      
      #add-course-form button:hover {
        background-color: #218838;
      }
      
      #back-btn {
        background-color: #6c757d;
        color: white;
        border: none;
        padding: 0.75rem 1.5rem;
        border-radius: 5px;
        cursor: pointer;
        margin-top: 1rem;
        transition: background-color 0.3s ease;
      }
      
      #back-btn:hover {
        background-color: #5a6268;
      }
    </style>
  </head>
  <body>
    <div class="form-container">
      <h1>Add New Course</h1>
      <form id="add-course-form">
        <label for="day">Day of the Week:</label>
        <select id="day" required>
          <option value="Monday">Monday</option>
          <option value="Tuesday">Tuesday</option>
          <option value="Wednesday">Wednesday</option>
          <option value="Thursday">Thursday</option>
          <option value="Friday">Friday</option>
        </select>
        
        <label for="start_time">Start Time:</label>
        <input type="time" id="start_time" required />
        
        <label for="end_time">End Time:</label>
        <input type="time" id="end_time" required />

        <label for="course_name">Course Name:</label>
        <input type="text" id="course_name" required />
        
        <label for="professor">Professor:</label>
        <input type="text" id="professor" />

        <label for="location">Location:</label>
        <input type="text" id="location" />

        <button type="submit">Save Course</button>
      </form>
      <button id="back-btn">Go Back</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
      const SUPABASE_URL = "https://izyofljxfnmcrtyhpkhp.supabase.co";
      const SUPABASE_ANON_KEY =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml6eW9mbGp4Zm5tY3J0eWhwa2hwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTc1ODM3MDgsImV4cCI6MjA3MzE1OTcwOH0.LgnXAHlFJ8GEZDpUMG9dXeioCd7Q25pL3hnXcTjkq4Y";

      const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      document.addEventListener("DOMContentLoaded", () => {
        // Redirect to login if not authenticated
        async function checkUser() {
          const {
            data: { user },
          } = await supabase.auth.getUser();
          if (!user) {
            window.location.href = "index.html";
          }
        }
        checkUser();

        // Auto-fill end time
        const startTimeInput = document.getElementById("start_time");
        const endTimeInput = document.getElementById("end_time");

        startTimeInput.addEventListener("change", () => {
          if (startTimeInput.value) {
            const [hours, minutes] = startTimeInput.value.split(":").map(Number);
            let newMinutes = minutes + 50;
            let newHours = hours;

            if (newMinutes >= 60) {
              newMinutes -= 60;
              newHours += 1;
            }

            // Format to HH:MM string
            const endHours = String(newHours).padStart(2, "0");
            const endMinutes = String(newMinutes).padStart(2, "0");
            endTimeInput.value = `${endHours}:${endMinutes}`;
          }
        });

        // Handle form submission
        document
          .getElementById("add-course-form")
          .addEventListener("submit", async (event) => {
            event.preventDefault();

            const {
              data: { user },
            } = await supabase.auth.getUser();
            if (!user) {
              alert("User not authenticated. Please log in.");
              return;
            }

            const newCourse = {
              user_id: user.id,
              day: document.getElementById("day").value,
              start_time: document.getElementById("start_time").value,
              end_time: document.getElementById("end_time").value,
              course_name: document.getElementById("course_name").value,
              professor: document.getElementById("professor").value,
              location: document.getElementById("location").value,
            };

            const { error } = await supabase.from("schedules").insert([newCourse]);

            if (error) {
              alert("Error saving course: " + error.message);
            } else {
              alert("Course saved successfully!");
              window.location.href = "dashboard.html"; // Redirect back to dashboard
            }
          });

        // Go back button functionality
        document.getElementById("back-btn").addEventListener("click", () => {
          window.location.href = "dashboard.html";
        });
      });
    </script>
  </body>
</html>